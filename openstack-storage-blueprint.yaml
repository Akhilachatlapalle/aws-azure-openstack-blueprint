tosca_definitions_version: cloudify_dsl_1_3


imports:
  - http://www.getcloudify.org/spec/cloudify/3.4/types.yaml
  - http://www.getcloudify.org/spec/openstack-plugin/1.4/plugin.yaml

inputs:

  vol_name:
    default: openstack-composed-volume
    type: string

  vol_size:
    default: 2

dsl_definitions:
  openstack_configuration: &openstack_configuration
    username: { get_input: keystone_username }
    password: { get_input: keystone_password }
    tenant_name: { get_input: keystone_tenant_name }
    auth_url: { get_input: keystone_url }
    region: { get_input: region }
    nova_url: { get_input: nova_url }
    neutron_url: { get_input: neutron_url }

node_templates:

  volume:
    type: cloudify.openstack.nodes.Volume
    properties:
      volume:
        size: { get_input: vol_size }
      openstack_config: *openstack_configuration
      resource_id: { get_input: vol_name }
    relationships:
      - type: cloudify.openstack.volume_attached_to_server
        target: openstack_server
